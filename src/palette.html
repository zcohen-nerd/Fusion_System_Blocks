<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8" />
  <title>System Blocks</title>
  <style>
    html, body { height:100%; margin:0; font-family: system-ui, sans-serif; }
    
    header { 
      padding: 8px 12px; 
      background: #f0f0f0; 
      border-bottom: 1px solid #ccc;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .toolbar {
      display: flex;
      gap: 8px;
    }
    
    .toolbar button {
      padding: 6px 12px;
      border: 1px solid #999;
      background: white;
      border-radius: 3px;
      cursor: pointer;
      font-size: 12px;
    }
    
    .toolbar button:hover {
      background: #e6e6e6;
    }
    
    .toolbar button.toggle-btn.active {
      background: #0066cc;
      color: white;
    }
    
    .toolbar button.toggle-btn:hover {
      background: #0052a3;
    }
    
    .toolbar .separator {
      width: 1px;
      height: 20px;
      background: #ccc;
      margin: 0 4px;
    }
    
    .toolbar button.context-btn:disabled {
      background: #f5f5f5;
      color: #999;
      cursor: not-allowed;
    }
    
    .toolbar button.context-btn:not(:disabled):hover {
      background: #e6f3ff;
      border-color: #0066cc;
    }
    
    #canvas-container { 
      height: calc(100% - 60px); 
      position: relative;
      overflow: hidden;
    }
    
    #svg-canvas {
      width: 100%;
      height: 100%;
      background: 
        radial-gradient(circle, #ddd 1px, transparent 1px);
      background-size: 20px 20px;
      cursor: grab;
    }
    
    #svg-canvas:active {
      cursor: grabbing;
    }
    
    .block {
      fill: #e6f3ff;
      stroke: #0066cc;
      stroke-width: 2;
      cursor: move;
    }
    
    .block:hover {
      fill: #cce6ff;
    }
    
    .block.selected {
      stroke: #ff6600;
      stroke-width: 3;
    }
    
    .block-text {
      fill: #333;
      font-family: system-ui, sans-serif;
      font-size: 12px;
      text-anchor: middle;
      dominant-baseline: middle;
      pointer-events: none;
    }
    
    .connection {
      stroke: #666;
      stroke-width: 2;
      fill: none;
      marker-end: url(#arrowhead);
    }
    
    .port {
      fill: #fff;
      stroke: #333;
      stroke-width: 1;
      cursor: crosshair;
    }
    
    .port:hover {
      fill: #ffff99;
    }
    
    .status-legend {
      position: absolute;
      top: 60px;
      right: 10px;
      background: white;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 8px;
      font-size: 11px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      z-index: 100;
    }
    
    .status-legend h4 {
      margin: 0 0 6px 0;
      font-size: 12px;
      color: #333;
    }
    
    .status-item {
      display: flex;
      align-items: center;
      margin: 3px 0;
    }
    
    .status-color {
      width: 12px;
      height: 12px;
      border-radius: 2px;
      margin-right: 6px;
    }
  </style>
</head>
<body>
  <header>
    <strong>System Blocks Diagram</strong>
    <div class="toolbar">
      <button id="btn-new">New</button>
      <button id="btn-save">Save</button>
      <button id="btn-load">Load</button>
      <button id="btn-add-block">Add Block</button>
      <button id="btn-snap-grid" class="toggle-btn active">Snap to Grid</button>
      <div class="separator"></div>
      <button id="btn-link-cad" class="context-btn" disabled>Link to CAD</button>
      <button id="btn-link-ecad" class="context-btn" disabled>Link to ECAD</button>
    </div>
  </header>
  
  <div id="canvas-container">
    <svg id="svg-canvas" viewBox="0 0 1000 1000">
      <defs>
        <marker id="arrowhead" markerWidth="10" markerHeight="7" 
                refX="9" refY="3.5" orient="auto">
          <polygon points="0 0, 10 3.5, 0 7" fill="#666" />
        </marker>
      </defs>
      <g id="connections-layer"></g>
      <g id="blocks-layer"></g>
    </svg>
    
    <!-- Status Legend -->
    <div class="status-legend">
      <h4>Block Status</h4>
      <div class="status-item">
        <div class="status-color" style="background-color: #cccccc;"></div>
        <span>Placeholder</span>
      </div>
      <div class="status-item">
        <div class="status-color" style="background-color: #87ceeb;"></div>
        <span>Planned</span>
      </div>
      <div class="status-item">
        <div class="status-color" style="background-color: #ffd700;"></div>
        <span>In-Work</span>
      </div>
      <div class="status-item">
        <div class="status-color" style="background-color: #90ee90;"></div>
        <span>Implemented</span>
      </div>
      <div class="status-item">
        <div class="status-color" style="background-color: #00ff00;"></div>
        <span>Verified</span>
      </div>
    </div>
  </div>
  
  <script src="palette.js"></script>
</body>
</html>
